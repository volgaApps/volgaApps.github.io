<!DOCTYPE html>

<html>

<head>

<title>Web Audio API - iPad Test</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>
<h1>Web Audio API Test</h1>

<input type="button" onclick="playSound1()" value = "Play music">
<br>
<br>
<input type="button" onclick="stopSound1()" value="Stop music">

<script>
function handleMouseDown(evt) {
                console.log('handleMouseDown');
                evt.preventDefault();
                evt.stopPropagation();
                window.focus();
                
              }

              var n = 0;
              function handleMouseUp(evt) {
                evt.preventDefault();
                evt.stopPropagation();
                console.log('handleMouseUp');

                // n++;
                // if (n == 4) n = 0;
                // if (n == 0) playGameSound('click', {loop:false, sound: 1.0});
                // if (n == 1) playGameSound('bicycle', {loop:false, sound: 1.0});
                // if (n == 2) playGameSound('car_accident', {loop:false, sound: 1.0});
                // if (n == 3) playGameSound('car_moving', {loop:false, sound: 1.0});
              }

              var elem = document;
              elem.addEventListener('mousedown', handleMouseDown);
              elem.addEventListener('mouseup', handleMouseUp);
</script>

</body>

<script>
    const audioCtx = new AudioContext();
    let source;

    function getData() {
      source = new AudioBufferSourceNode(audioCtx);
      request = new XMLHttpRequest();

      request.open("GET", "back_loop.mp3", true);

      request.responseType = "arraybuffer";

      request.onload = () => {
        let audioData = request.response;

        audioCtx.decodeAudioData(
          audioData,
          (buffer) => {
            songLength = buffer.duration;
            source.buffer = buffer;
            source.playbackRate.value = playbackControl.value;
            source.connect(audioCtx.destination);
            source.loop = true;

            loopstartControl.setAttribute("max", Math.floor(songLength));
            loopendControl.setAttribute("max", Math.floor(songLength));
          },
          (e) => {
            `Error with decoding audio data ${e.error}`;
          }
        );
      };

      request.send();
    }

    // wire up buttons to stop and play audio, and range slider control

    function playSound1() {
        getData();
        source.start(0);
    }

    function stopSound1() {
        source.stop(0);
    }
</script>

</html>