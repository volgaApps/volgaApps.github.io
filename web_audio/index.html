<!doctype html>
<html>
<head>
    <title>CrossRoadPDD</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta id="gameViewport" name="viewport" content="width=device-width initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="styles.css" rel="stylesheet" type="text/css">
    <!-- Yandex Games SDK -->
    <script src="https://yandex.ru/games/sdk/v2"></script>
    <script>
                    YaGames
                        .init({
						screen: {
                            fullscreen: false,
                            orientation: {
                            value: 'portrait',
							    }
							},
						adv: {
                            onAdvClose: wasShown => {
                            console.info('adv closed!');
                                }
                            }
						})
						.then(ysdk => {
                                                 sdk = ysdk;
                           ysdk.adv.showFullscreenAdv();
        });
			  </script>

    <script>
       function showYndxAd() {
              console.log("start showYndxAd function, version = 2");
              sdk.adv.showFullscreenAdv({callbacks:{}});
       }
</script>

    <script>
       function getYndxPayload() {
              console.log("start getYndxPayload");
              if (typeof(sdk)=="undefined")
                     return "undefined";
              else return ""+sdk.environment.payload;
       }

       function setYndxPayloadEmpty() {
              sdk.environment.payload = "undefined";
       }
       
</script>

    <script>
function showStickyBannerYndx() {
       sdk.adv.getBannerAdvStatus().then(({ stickyAdvIsShowing , reason }) => {
    if (stickyAdvIsShowing) {
        console.log("sticky yndxBanner is showing");
    } else if(reason) {
        console.log("sticky yndxBanner isn't showing")
        console.log(reason);
    } else {
       console.log("show sticky yndxBanner")
        sdk.adv.showBannerAdv();
    }
})
}
</script>

    <script>
    function hideStickyBannerYndx() {
    // console.log("hideStickyBannerYndx() in hide");
    sdk.adv.hideBannerAdv();
    }
</script>

    <script>
        function appLaunchFromVK() {
        return false;
        }
</script>

    <script>
        function showHtmlRewardedVideoAd() {
        sdk.adv.showRewardedVideo({
        callbacks: {
        onOpen: () => {
          console.log('Video ad open.');
        },
        onRewarded: () => {
          console.log('Rewarded!');
          window.setOnRewarded(); // оповестить  HtmlLauncher о получении пользователем вознаграждения
        },
        onClose: () => {
          console.log('Video ad closed.');
        },
        onError: (e) => {
          console.log('Error while open video ad:', e);
          window.setRewardedOnError(); // оповестить об ошибке в загрузке объявления
        }
    }
})
        }
    </script>

<script>
window.onload = init;
var context;
var bufferLoader;
var bufList;
var gainNode;
var isPlayMusicTheme = false;
    
    function init() {
        alert('index.html vesion 1');

        context = new (window.AudioContext || window.webkitAudioContext)();
        
        bufList = new Array();
        gainNode = context.createGain();
        gainNode.gain.value = 1.0;

        bufferLoader = new BufferLoader(
            context,
            [
                'sounds/click.ogg',
                'sounds/alarm.ogg',
                'sounds/bicycle.ogg',
                'sounds/car_accident.ogg',
                'sounds/car_moving.ogg',
                'sounds/steps.ogg',
                'sounds/tram_sound.ogg'
              ],
              finishedLoading
              );
              bufferLoader.load();
          }

          var clickSound;
          var alarmSound;
          var bicycleSound;
          var carAccidentSound;
          var carMovingSound;
          var stepsSound;
          var tramSound;

          function finishedLoading(bufferList) {
              bufList = bufferList;
           //    console.log('bufList.length = ' + bufList.length);
          }

          function initWebAudioSounds() {
           // console.log('initMusicTheme()');
           isPlayMusicTheme = false;
           init();
          }

          function playClickSound() {
              isPlayMusicTheme = true;
              clickSound = context.createBufferSource();
              clickSound.loop = false;
              clickSound.buffer = bufList[0];
              clickSound.connect(gainNode);
              gainNode.connect(context.destination);
              clickSound.start(context.currentTime);
          }

          function playAlarmSound() {
            alarmSound = context.createBufferSource();
            alarmSound.buffer = bufList[1];
            alarmSound.connect(gainNode);
            gainNode.connect(context.destination);
            alarmSound.start(0);
          }

          function playBicycleSound() {
            bicycleSound = context.createBufferSource();
            bicycleSound.buffer = bufList[2];
            bicycleSound.connect(gainNode);
            gainNode.connect(context.destination);
            bicycleSound.start(0);
          }

          function playCarAccidentSound() {
            carAccidentSound = context.createBufferSource();
            carAccidentSound.buffer = bufList[3];
            carAccidentSound.connect(gainNode);
            gainNode.connect(context.destination);
            carAccidentSound.start(0);
          }

          function playCarMovingSound() {
            carMovingSound = context.createBufferSource();
            carMovingSound.buffer = bufList[4];
            carMovingSound.connect(gainNode);
            gainNode.connect(context.destination);
            carMovingSound.start(0);
          }

          function playStepsSound() {
            stepsSound = context.createBufferSource();
            stepsSound.buffer = bufList[5];
            stepsSound.connect(gainNode);
            gainNode.connect(context.destination);
            stepsSound.start(0);
          }

          function playTramSound() {
            tramSound = context.createBufferSource();
            tramSound.buffer = bufList[6];
            tramSound.connect(gainNode);
            gainNode.connect(context.destination);
            tramSound.start(0);
          }

          function pauseMusicTheme() {
           // console.log('pauseMusicTheme()');
           context.suspend();
          }

          function resumeMusicTheme() {
           // console.log('resumeMusicTheme()');
           // console.log('isPlayMusicTheme = ' + isPlayMusicTheme)
           if (isPlayMusicTheme) context.resume();
           else playMusicTheme();
          }

          function setVolume(volume) {
           gainNode.gain.value = volume;
          }

          function stopMusicTheme() {
           // console.log('stopMusicTheme()')
              try {
                  clickSound.stop(context.currentTime);
              } catch (error) {
                //   console.log('ERROR', 'stop music exception = ' + error)
              }
          }

function BufferLoader(context, urlList, callback) {
    this.context = context;
    this.urlList = urlList;
    this.onload = callback;
    this.bufferList = new Array();
    this.loadCount = 0;

  }

  BufferLoader.prototype.loadBuffer = function(url, index) {
      // Load buffer asynchronously
      var request = new XMLHttpRequest();
      request.open("GET", url, true);
      request.responseType = "arraybuffer";

      var loader = this;

      request.onload = function() {
          // Asynchronously decode the audio file data in request.response
          loader.context.decodeAudioData(
              request.response,
              function(buffer) {
                  if (!buffer) {
                      alert('error decoding file data: ' + url);
                      return;
                  }
                  loader.bufferList[index] = buffer;
                  if (++loader.loadCount == loader.urlList.length)
                  loader.onload(loader.bufferList);
              },
              function(error) {
                  console.error('decodeAudioData error', error);
              }
              );
          }

          request.onerror = function() {
              alert('BufferLoader: XHR error');
          }

          request.send();
      }

      BufferLoader.prototype.load = function() {

          for (var i = 0; i < this.urlList.length; ++i)
          this.loadBuffer(this.urlList[i], i);
          }
</script>

</head>

<body>
<div align="center" id="embed-html"></div>
<script type="text/javascript" src="html/html.nocache.js"></script>
</body>

<script>
              function handleMouseDown(evt) {
                evt.preventDefault();
                evt.stopPropagation();
                window.focus();
              }

              function handleMouseUp(evt) {
                evt.preventDefault();
                evt.stopPropagation();
              }
              document.getElementById('embed-html').addEventListener('mousedown', handleMouseDown, false);
              document.getElementById('embed-html').addEventListener('mouseup', handleMouseUp, false);
       </script>
</html>
